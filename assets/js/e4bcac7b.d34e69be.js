"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[2490],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(a),d=r,g=p["".concat(l,".").concat(d)]||p[d]||m[d]||o;return a?n.createElement(g,i(i({ref:t},u),{},{components:a})):n.createElement(g,i({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5563:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],s={id:"custom_activation_strategy",title:"Custom Activation Strategy"},l=void 0,c={unversionedId:"advanced/custom_activation_strategy",id:"advanced/custom_activation_strategy",isDocsHomePage:!1,title:"Custom Activation Strategy",description:"Even though Unleash comes with a few powerful activation strategies there might be scenarios where you would like to extend Unleash with your own custom strategies.",source:"@site/docs/advanced/custom-activation-strategy.md",sourceDirName:"advanced",slug:"/advanced/custom_activation_strategy",permalink:"/advanced/custom_activation_strategy",editUrl:"https://github.com/Unleash/unleash/edit/master/website/docs/advanced/custom-activation-strategy.md",tags:[],version:"current",frontMatter:{id:"custom_activation_strategy",title:"Custom Activation Strategy"},sidebar:"documentation",previous:{title:"Strategy Constraints",permalink:"/advanced/strategy_constraints"},next:{title:"Feature Toggle Types",permalink:"/advanced/feature_toggle_types"}},u=[{value:"Example: TimeStamp Strategy",id:"example-timestamp-strategy",children:[{value:"Define custom strategy",id:"define-custom-strategy",children:[],level:4},{value:"Use custom strategy",id:"use-custom-strategy",children:[],level:4},{value:"Client implementation",id:"client-implementation",children:[],level:4}],level:3}],m={toc:u};function p(e){var t=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Even though Unleash comes with a few powerful ",(0,o.kt)("a",{parentName:"p",href:"/user_guide/activation_strategy"},"activation strategies")," there might be scenarios where you would like to extend Unleash with your own custom strategies."),(0,o.kt)("h3",{id:"example-timestamp-strategy"},"Example: TimeStamp Strategy"),(0,o.kt)("p",null,"In this example we want to define an activation strategy offers a scheduled release of a feature toggle. This means that we want the feature toggle to be activated after a given date and time."),(0,o.kt)("h4",{id:"define-custom-strategy"},"Define custom strategy"),(0,o.kt)("p",null,'First we need to "define" our new strategy. To add a new "Strategy", open the Strategies tab from the sidebar.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"A strategy creation form. It has fields labeled &quot;strategy name&quot; and &quot;description&quot;. It also has fields for a parameter named &quot;enableAfter&quot;. The parameter is of type &quot;string&quot; and the description is &quot;Expected format: YYYY-MM-DD HH:MM&quot;. The parameter is required.",src:a(9936).Z})),(0,o.kt)("p",null,"We name our strategy ",(0,o.kt)("inlineCode",{parentName:"p"},"TimeStamp")," and add one required parameter of type string, which we call ",(0,o.kt)("inlineCode",{parentName:"p"},"enableAfter"),"."),(0,o.kt)("h4",{id:"use-custom-strategy"},"Use custom strategy"),(0,o.kt)("p",null,"After we have created the strategy definition, we can now decide to use that activation strategy for our feature toggle."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The strategy configuration screen for the TimeStamp strategy. It shows the strategy from above with a date entered into the &quot;enableAfter&quot; field.",src:a(2904).Z})),(0,o.kt)("p",null,"In the example we want to use our custom strategy for the feature toggle named ",(0,o.kt)("inlineCode",{parentName:"p"},"demo.TimeStampRollout"),"."),(0,o.kt)("h4",{id:"client-implementation"},"Client implementation"),(0,o.kt)("p",null,"All official client SDK's for Unleash provides abstractions for you to implement support for custom strategies."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Before you have provided support for the custom strategy; the client will return false, because it does not understand the activation strategy.")),(0,o.kt)("p",null,"In Node.js the implementation for the ",(0,o.kt)("inlineCode",{parentName:"p"},"TimeStampStrategy")," would be:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"class TimeStampStrategy extends Strategy {\n  constructor() {\n    super('TimeStamp');\n  }\n\n  isEnabled(parameters, context) {\n    return Date.parse(parameters.enableAfter) < Date.now();\n  }\n}\n")),(0,o.kt)("p",null,"In the example implementation we make use of the library called moment to parse the timestamp and verify that current time is after the specified ",(0,o.kt)("inlineCode",{parentName:"p"},"enabledAfter")," parameter."),(0,o.kt)("p",null,"All parameter injected to the strategy are handled as ",(0,o.kt)("inlineCode",{parentName:"p"},"string")," objects. This means that the strategies needs to parse it to a more suitable format. In this example we just parse it directly to a ",(0,o.kt)("inlineCode",{parentName:"p"},"Date")," type and do the comparison directly. You might want to also consider timezone in a real implementation."),(0,o.kt)("p",null,"We also have to remember to register the custom strategy when initializing the Unleash client. Full working code example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const { Strategy, initialize, isEnabled } = require('unleash-client');\n\nclass TimeStampStrategy extends Strategy {\n  constructor() {\n    super('TimeStamp');\n  }\n\n  isEnabled(parameters, context) {\n    return Date.parse(parameters.enableAfter) < Date.now();\n  }\n}\n\nconst instance = initialize({\n  url: 'http://unleash.herokuapp.com/api/',\n  appName: 'unleash-demo',\n  instanceId: '1',\n  strategies: [new TimeStampStrategy()],\n});\n\ninstance.on('ready', () => {\n  setInterval(() => {\n    console.log(isEnabled('demo.TimeStampRollout'));\n  }, 1000);\n});\n")))}p.isMDXComponent=!0},9936:function(e,t,a){t.Z=a.p+"assets/images/timestamp_create_strategy-103954747a03c73d36bec4756291ef24.png"},2904:function(e,t,a){t.Z=a.p+"assets/images/timestamp_use_strategy-a22bd279597bae1e57a22f214caa05c8.png"}}]);