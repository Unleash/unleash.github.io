"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[9354],{89932:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const o={title:"React",slug:"/reference/sdks/react"},s=void 0,l={unversionedId:"generated/sdks/client-side/react",id:"generated/sdks/client-side/react",title:"React",description:"This document was generated from the README in the React GitHub repository.",source:"@site/docs/generated/sdks/client-side/react.md",sourceDirName:"generated/sdks/client-side",slug:"/reference/sdks/react",permalink:"/reference/sdks/react",draft:!1,editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/generated/sdks/client-side/react.md",tags:[],version:"current",frontMatter:{title:"React",slug:"/reference/sdks/react"},sidebar:"documentation",previous:{title:"Next.js",permalink:"/reference/sdks/next-js"},next:{title:"Svelte",permalink:"/reference/sdks/svelte"}},i={},c=[{value:"Initialize the client",id:"initialize-the-client",level:2},{value:"Connection options",id:"connection-options",level:3},{value:"Check feature toggle status",id:"check-feature-toggle-status",level:2},{value:"Check variants",id:"check-variants",level:2},{value:"Defer rendering until flags fetched",id:"defer-rendering-until-flags-fetched",level:2},{value:"Updating context",id:"updating-context",level:2},{value:"Deferring client start",id:"deferring-client-start",level:2},{value:"Use unleash client directly",id:"use-unleash-client-directly",level:2},{value:"Usage with class components",id:"usage-with-class-components",level:2},{value:"React Native",id:"react-native",level:2},{value:"Upgrade path from v1 -&gt; v2",id:"upgrade-path-from-v1---v2",level:2},{value:"Upgrade path from v2 -&gt; v3",id:"upgrade-path-from-v2---v3",level:2},{value:"Upgrade path from v3 -&gt; v4",id:"upgrade-path-from-v3---v4",level:2}],p={toc:c};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"Generated content",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"This document was generated from the README in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Unleash/proxy-client-react"},"React GitHub repository"),".")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To connect to Unleash from a client-side context, you'll need to use the ",(0,r.kt)("a",{parentName:"p",href:"/reference/front-end-api"},"Unleash front-end API")," (",(0,r.kt)("a",{parentName:"p",href:"/how-to/how-to-create-api-tokens"},"how do I create an API token?"),") or the ",(0,r.kt)("a",{parentName:"p",href:"/reference/unleash-proxy"},"Unleash proxy")," (",(0,r.kt)("a",{parentName:"p",href:"/reference/api-tokens-and-client-keys#proxy-client-keys"},"how do I create client keys?"),").")),(0,r.kt)("h1",{id:"installation"},"Installation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @unleash/proxy-client-react unleash-proxy-client\n# or\nyarn add @unleash/proxy-client-react unleash-proxy-client\n")),(0,r.kt)("h1",{id:"how-to-use"},"How to use"),(0,r.kt)("h2",{id:"initialize-the-client"},"Initialize the client"),(0,r.kt)("p",null,"Prepare ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-proxy"},"Unleash Proxy")," secret\nor ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/front-end-api"},"Frontend API Access")," token."),(0,r.kt)("p",null,"Import the provider like this in your entrypoint file (typically index.js/ts):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { createRoot } from 'react-dom/client';\nimport { FlagProvider } from '@unleash/proxy-client-react';\n\nconst config = {\n  url: '<unleash-url>/api/frontend', // Your front-end API URL or the Unleash proxy's URL (https://<proxy-url>/proxy)\n  clientKey: '<your-token>', // A client-side API token OR one of your proxy's designated client keys (previously known as proxy secrets)\n  refreshInterval: 15, // How often (in seconds) the client should poll the proxy for updates\n  appName: 'your-app-name', // The name of your application. It's only used for identifying your application\n};\n\nconst root = createRoot(document.getElementById('root'));\n\nroot.render(\n  <React.StrictMode>\n    <FlagProvider config={config}>\n      <App />\n    </FlagProvider>\n  </React.StrictMode>\n);\n")),(0,r.kt)("h3",{id:"connection-options"},"Connection options"),(0,r.kt)("p",null,"To connect this SDK to your Unleash instance's ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/front-end-api"},"front-end API"),", use the URL to your Unleash instance's front-end API (",(0,r.kt)("inlineCode",{parentName:"p"},"<unleash-url>/api/frontend"),") as the ",(0,r.kt)("inlineCode",{parentName:"p"},"url")," parameter. For the ",(0,r.kt)("inlineCode",{parentName:"p"},"clientKey")," parameter, use a ",(0,r.kt)("inlineCode",{parentName:"p"},"FRONTEND")," token generated from your Unleash instance. Refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/how-to/how-to-create-api-tokens"},(0,r.kt)("em",{parentName:"a"},"how to create API tokens"))," guide for the necessary steps."),(0,r.kt)("p",null,"To connect this SDK to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-proxy"},"Unleash proxy"),", use the proxy's URL and a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/api-tokens-and-client-keys#proxy-client-keys"},"proxy client key"),". The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-proxy#configuration"},(0,r.kt)("em",{parentName:"a"},"configuration")," section of the Unleash proxy docs")," contains more info on how to configure client keys for your proxy."),(0,r.kt)("h2",{id:"check-feature-toggle-status"},"Check feature toggle status"),(0,r.kt)("p",null,"To check if a feature is enabled:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { useFlag } from '@unleash/proxy-client-react';\n\nconst TestComponent = () => {\n  const enabled = useFlag('travel.landing');\n\n  if (enabled) {\n    return <SomeComponent />;\n  }\n  return <AnotherComponent />;\n};\n\nexport default TestComponent;\n")),(0,r.kt)("h2",{id:"check-variants"},"Check variants"),(0,r.kt)("p",null,"To check variants:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { useVariant } from '@unleash/proxy-client-react';\n\nconst TestComponent = () => {\n  const variant = useVariant('travel.landing');\n\n  if (variant.enabled && variant.name === 'SomeComponent') {\n    return <SomeComponent />;\n  } else if (variant.enabled && variant.name === 'AnotherComponent') {\n    return <AnotherComponent />;\n  }\n  return <DefaultComponent />;\n};\n\nexport default TestComponent;\n")),(0,r.kt)("h2",{id:"defer-rendering-until-flags-fetched"},"Defer rendering until flags fetched"),(0,r.kt)("p",null,"useFlagsStatus retrieves the ready state and error events.\nFollow the following steps in order to delay rendering until the flags have been fetched."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { useFlagsStatus } from '@unleash/proxy-client-react';\n\nconst MyApp = () => {\n  const { flagsReady, flagsError } = useFlagsStatus();\n\n  if (!flagsReady) {\n    return <Loading />;\n  }\n  return <MyComponent error={flagsError} />;\n};\n")),(0,r.kt)("h2",{id:"updating-context"},"Updating context"),(0,r.kt)("p",null,"Follow the following steps in order to update the unleash context:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { useUnleashContext, useFlag } from '@unleash/proxy-client-react';\n\nconst MyComponent = ({ userId }) => {\n  const variant = useFlag('my-toggle');\n  const updateContext = useUnleashContext();\n\n  useEffect(() => {\n    // context is updated with userId\n    updateContext({ userId });\n  }, [userId]);\n\n  // OR if you need to perform an action right after new context is applied\n  useEffect(() => {\n    async function run() {\n      // Can wait for the new flags to pull in from the different context\n      await updateContext({ userId });\n      console.log('new flags loaded for', userId);\n    }\n    run();\n  }, [userId]);\n};\n")),(0,r.kt)("h1",{id:"advanced-use-cases"},"Advanced use cases"),(0,r.kt)("h2",{id:"deferring-client-start"},"Deferring client start"),(0,r.kt)("p",null,"By default, the Unleash client will start polling the Proxy for toggles immediately when the ",(0,r.kt)("inlineCode",{parentName:"p"},"FlagProvider")," component renders. You can prevent it by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"startClient")," prop to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),". This is useful when you'd like to for example bootstrap the client and work offline."),(0,r.kt)("p",null,"Deferring the client start gives you more fine-grained control over when to start fetching the feature toggle configuration. This could be handy in cases where you need to get some other context data from the server before fetching toggles, for instance."),(0,r.kt)("p",null,"To start the client, use the client's ",(0,r.kt)("inlineCode",{parentName:"p"},"start")," method. The below snippet of pseudocode will defer polling until the end of the ",(0,r.kt)("inlineCode",{parentName:"p"},"asyncProcess")," function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"const client = new UnleashClient({\n  /* ... */\n});\n\nconst MyAppComponent = () => {\n  useEffect(() => {\n    const asyncProcess = async () => {\n      // do async work ...\n      client.start();\n    };\n    asyncProcess();\n  }, []);\n\n  return (\n    // Pass client as `unleashClient` and set `startClient` to `false`\n    <FlagProvider unleashClient={client} startClient={false}>\n      <App />\n    </FlagProvider>\n  );\n};\n")),(0,r.kt)("h2",{id:"use-unleash-client-directly"},"Use unleash client directly"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { useUnleashContext, useUnleashClient } from '@unleash/proxy-client-react'\n\nconst MyComponent = ({ userId }) => {\n  const client = useUnleashClient();\n\n  const login = () => {\n    // login user\n    if (client.isEnabled(\"new-onboarding\")) {\n      // Send user to new onboarding flow\n    } else (\n      // send user to old onboarding flow\n    )\n  }\n\n  return <LoginForm login={login}/>\n}\n")),(0,r.kt)("h2",{id:"usage-with-class-components"},"Usage with class components"),(0,r.kt)("p",null,"Since this library uses hooks you have to implement a wrapper to use with class components. Beneath you can find an example of how to use this library with class components, using a custom wrapper:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react';\nimport {\n  useFlag,\n  useUnleashClient,\n  useUnleashContext,\n  useVariant,\n  useFlagsStatus,\n} from '@unleash/proxy-client-react';\n\ninterface IUnleashClassFlagProvider {\n  render: (props: any) => React.ReactNode;\n  flagName: string;\n}\n\nexport const UnleashClassFlagProvider = ({\n  render,\n  flagName,\n}: IUnleashClassFlagProvider) => {\n  const enabled = useFlag(flagName);\n  const variant = useVariant(flagName);\n  const client = useUnleashClient();\n\n  const updateContext = useUnleashContext();\n  const { flagsReady, flagsError } = useFlagsStatus();\n\n  const isEnabled = () => {\n    return enabled;\n  };\n\n  const getVariant = () => {\n    return variant;\n  };\n\n  const getClient = () => {\n    return client;\n  };\n\n  const getUnleashContextSetter = () => {\n    return updateContext;\n  };\n\n  const getFlagsStatus = () => {\n    return { flagsReady, flagsError };\n  };\n\n  return (\n    <>\n      {render({\n        isEnabled,\n        getVariant,\n        getClient,\n        getUnleashContextSetter,\n        getFlagsStatus,\n      })}\n    </>\n  );\n};\n")),(0,r.kt)("p",null,"Wrap your components like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'<UnleashClassFlagProvider\n  flagName="demoApp.step1"\n  render={({ isEnabled, getClient }) => (\n    <MyClassComponent isEnabled={isEnabled} getClient={getClient} />\n  )}\n/>\n')),(0,r.kt)("h2",{id:"react-native"},"React Native"),(0,r.kt)("p",null,"IMPORTANT: This no longer comes included in the unleash-proxy-client-js library. You will need to install the storage adapter for your preferred storage solution."),(0,r.kt)("p",null,"Because React Native doesn't run in a web browser, it doesn't have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage")," API. Instead, you need to tell Unleash to use your specific storage provider. The most common storage provider for React Native is ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/react-native-async-storage/async-storage"},"AsyncStorage"),".\nTo configure it, add the following property to your configuration object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const config = {\n  storageProvider: {\n    save: (name, data) => AsyncStorage.setItem(name, JSON.stringify(data)),\n    get: async (name) => {\n      const data = await AsyncStorage.getItem(name);\n      return data ? JSON.parse(data) : undefined;\n    },\n  },\n};\n")),(0,r.kt)("h1",{id:"migration-guide"},"Migration guide"),(0,r.kt)("h2",{id:"upgrade-path-from-v1---v2"},"Upgrade path from v1 -> v2"),(0,r.kt)("p",null,"If you were previously using the built in Async storage used in the unleash-proxy-client-js, this no longer comes bundled with the library. You will need to install the storage adapter for your preferred storage solution. Otherwise there are no breaking changes."),(0,r.kt)("h2",{id:"upgrade-path-from-v2---v3"},"Upgrade path from v2 -> v3"),(0,r.kt)("p",null,"Previously the unleash client was bundled as dependency directly in this library. It's now changed to a peer dependency and listed as an external."),(0,r.kt)("p",null,"In v2 there was only one distribution based on the fact that webpack polyfilled the necessary features in v4. This is no longer the case in webpack v5. We now provide two distribution builds, one for the server and one for the client - and use the browser field in the npm package to hint module builders about which version to use. The default ",(0,r.kt)("inlineCode",{parentName:"p"},"dist/index.js")," file points to the node version, while the web build is located at ",(0,r.kt)("inlineCode",{parentName:"p"},"dist/index.browser.js")),(0,r.kt)("p",null,"Upgrading should be as easy as running yarn again with the new version, but we made the made bump regardless to be safe. Note: If you are not able to resolve the peer dependency on ",(0,r.kt)("inlineCode",{parentName:"p"},"unleash-proxy-client")," you might need to run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install unleash-proxy-client")),(0,r.kt)("h2",{id:"upgrade-path-from-v3---v4"},"Upgrade path from v3 -> v4"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"startClient")," option has been simpilfied. Now it will also work if you don't pass custom client with it, and in SSR (when ",(0,r.kt)("inlineCode",{parentName:"p"},"typeof window === 'undefined'"),") it defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"This content was generated on ",(0,r.kt)("time",{dateTime:"2023-04-22T00:14:51.957Z"},"22 April 2023 at 00:14:51 Coordinated Universal Time")))}d.isMDXComponent=!0}}]);