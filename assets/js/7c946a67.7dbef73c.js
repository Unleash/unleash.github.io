"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[8297],{55339:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const i={title:"How to set up Keycloak and Unleash to sync user groups"},l=void 0,s={unversionedId:"how-to/how-to-setup-sso-keycloak-group-sync",id:"how-to/how-to-setup-sso-keycloak-group-sync",title:"How to set up Keycloak and Unleash to sync user groups",description:"User group syncing is an upcoming Unleash feature that will be available for enterprise customers.",source:"@site/docs/how-to/how-to-setup-sso-keycloak-group-sync.md",sourceDirName:"how-to",slug:"/how-to/how-to-setup-sso-keycloak-group-sync",permalink:"/how-to/how-to-setup-sso-keycloak-group-sync",draft:!1,editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/how-to/how-to-setup-sso-keycloak-group-sync.md",tags:[],version:"current",frontMatter:{title:"How to set up Keycloak and Unleash to sync user groups"},sidebar:"documentation",previous:{title:"[Deprecated] How to add SSO with Google",permalink:"/advanced/sso-google"},next:{title:"Reference documentation",permalink:"/reference"}},p={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Keycloak Configuration",id:"keycloak-configuration",level:2},{value:"Step 1: Navigate to Create Client",id:"keycloak-step-1",level:3},{value:"Step 2: Create an Unleash Client",id:"keycloak-step-2",level:3},{value:"Step 3: Set a redirect URI",id:"keycloak-step-3",level:3},{value:"Step 4: Copy your client secret",id:"keycloak-step-4",level:3},{value:"Step 5: Copy your OpenID endpoint configuration",id:"keycloak-step-5",level:3},{value:"Step 6: Create a new Client Scope and Map Groups",id:"keycloak-step-6",level:3},{value:"Unleash Configuration",id:"unleash-configuration",level:2},{value:"Step 1: Navigate to the Unleash SSO Configuration",id:"unleash-step-1",level:3},{value:"Step 2: Enable Group Syncing",id:"unleash-step-2",level:3},{value:"Step 3: Enable Group Syncing for your Group",id:"unleash-step-3",level:3}],h={toc:c};function u(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,n.Z)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{title:"availability",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"User group syncing is an upcoming Unleash feature that will be available for enterprise customers.")),(0,o.kt)("p",null,"In this guide, we will setup OIDC Single Sign-On (SSO) in Keycloak and configure Unleash to automatically sync user group membership from Keycloak."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"The steps in this guide assume you have admin access to a running Unleash instance and to a running Keycloak instance."),(0,o.kt)("h2",{id:"keycloak-configuration"},"Keycloak Configuration"),(0,o.kt)("h3",{id:"keycloak-step-1"},"Step 1: Navigate to Create Client"),(0,o.kt)("p",null,'Open the Keycloak admin dashboard, navigate to clients and select "Create Client".'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak Admin UI with the steps highlighted to navigate to client configuration.",src:a(888).Z,width:"1056",height:"575"})),(0,o.kt)("h3",{id:"keycloak-step-2"},"Step 2: Create an Unleash Client"),(0,o.kt)("p",null,'Select "OpenID Connect" as the client type and give your client a name, then save your configuration.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak Admin UI with the client configuration open.",src:a(33132).Z,width:"1108",height:"615"})),(0,o.kt)("h3",{id:"keycloak-step-3"},"Step 3: Set a redirect URI"),(0,o.kt)("p",null,"Set the redirect URI to:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"<base-url>/auth/oidc/callback")),(0,o.kt)("p",null,"For a hosted Unleash instance this becomes:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"https://<region>.app.unleash-hosted.com/<instance-name>/auth/oidc/callback")),(0,o.kt)("p",null,"Save your configuration."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak client configuration with redirect URIs highlighted.",src:a(47849).Z,width:"1105",height:"822"})),(0,o.kt)("h3",{id:"keycloak-step-4"},"Step 4: Copy your client secret"),(0,o.kt)("p",null,"Navigate to \"Credentials\" and copy your client secret. You'll need to add this to the Unleash configuration later, so put it somewhere you'll be able to find it."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak credentials configuration with copy client secret highlighted.",src:a(23499).Z,width:"1090",height:"639"})),(0,o.kt)("h3",{id:"keycloak-step-5"},"Step 5: Copy your OpenID endpoint configuration"),(0,o.kt)("p",null,"Navigate to your realm settings and copy the link to OpenID endpoint configuration. You'll need to add this to the Unleash configuration later."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak realm settings the OpenID endpoint configuration link highlighted.",src:a(82405).Z,width:"1091",height:"814"})),(0,o.kt)("h3",{id:"keycloak-step-6"},"Step 6: Create a new Client Scope and Map Groups"),(0,o.kt)("p",null,'Navigate to the "Client Scopes" page and select "Create Client Scope".'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak Client Scopes page with the Create Client Scope button highlighted.",src:a(42461).Z,width:"1137",height:"695"})),(0,o.kt)("p",null,'Give your new scope a name. Set the type to "Optional". Make sure the protocol is set to "OpenID Connect" and the "Include in Token Response" option is enabled. Save your new scope.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak Add Client Scope page with the Name, Type, Protocol and Include in Token Response fields highlighted.",src:a(82725).Z,width:"972",height:"763"})),(0,o.kt)("p",null,'Navigate the the Mappers tab and select "Configure new Mapper".'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak Client Scope details page with the Mappers tab and Configure new Mapper element highlighted.",src:a(73751).Z,width:"1228",height:"616"})),(0,o.kt)("p",null,"Select the Group Membership mapper."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak mapper popup with the Group Membership mapper highlighted.",src:a(4536).Z,width:"829",height:"839"})),(0,o.kt)("p",null,'Give your mapper a claim name, this must match the "Group Field JSON Path" in Unleash, and turn off the "Full group path" option.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Keycloak mapper options screen with the Token Claim Name and Full Group Path elements highlighted.",src:a(47212).Z,width:"1145",height:"690"})),(0,o.kt)("h2",{id:"unleash-configuration"},"Unleash Configuration"),(0,o.kt)("h3",{id:"unleash-step-1"},"Step 1: Navigate to the Unleash SSO Configuration"),(0,o.kt)("p",null,"Log in to Unleash as an admin user and navigate to the SSO configuration. Input your Client Secret (copied in step 3 of the Keycloak configuration), your Discover URL (copied in step 4  of the Keycloak configuration), and the Client ID (from step 2 of the Keycloak configuration)."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Unleash SSO configuration screen with Client ID, Client Secret and Discover URL highlighted.",src:a(74841).Z,width:"1350",height:"782"})),(0,o.kt)("h3",{id:"unleash-step-2"},"Step 2: Enable Group Syncing"),(0,o.kt)("p",null,'Turn on Group Syncing and set a value for "Group Field JSON Path". This must match the value in claim name in Keycloak exactly. Save your configuration.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Unleash SSO configuration screen with the Enable Group Syncing and Group Field JSON Path highlighted.",src:a(54919).Z,width:"1192",height:"780"})),(0,o.kt)("h3",{id:"unleash-step-3"},"Step 3: Enable Group Syncing for your Group"),(0,o.kt)("p",null,"Navigate to Groups and select the group that you want to sync."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Groups page with a group element highlighted.",src:a(49304).Z,width:"1296",height:"551"})),(0,o.kt)("p",null,"Edit the group."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The Group page with the Edit group element highlighted.",src:a(21086).Z,width:"1318",height:"530"})),(0,o.kt)("p",null,"Add as many SSO groups as you like. These need to match the Keycloak groups exactly."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"The edit group page with the add SSO group element highlighted.",src:a(43975).Z,width:"1278",height:"733"})),(0,o.kt)("p",null,"Save your configuration. Once a user belonging to one of these Keycloak groups logs in through SSO, they'll be automatically added to this Unleash group."))}u.isMDXComponent=!0},888:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-1-98f57688f45277917bfe228779a1f61f.png"},47212:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-10-cdbf21fce54287bca574a795892e858a.png"},74841:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-11-829ad147e85016b530e6cf14ef652e2c.png"},54919:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-12-23e5f9d42e07691b53df3bfb800b027c.png"},49304:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-13-77579e2692c17798a156bdc2d5265f2a.png"},21086:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-14-c1dafee817734411398b8e274ee07e64.png"},43975:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-15-9c647112284e4000a39eec5846686883.png"},33132:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-2-3322eeeff4162e55cd279a9a485ae846.png"},47849:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-3-b6f205c3bcf386dda0dd2d60c6a671de.png"},23499:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-4-2f0905ee878a7cb91a5963ae4723ca5d.png"},82405:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-5-716d7cad120b52cdcc54612935a73e50.png"},42461:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-6-9f1f7cbec38919652d9198966504a053.png"},82725:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-7-186447f559d7bf3ba57f19d5c9b53def.png"},73751:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-8-1baa7629507e114ab9fa5bc0552bfeba.png"},4536:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/setup-keycloak-sync-9-48e8839a10276fd0704382577fdb1331.png"}}]);