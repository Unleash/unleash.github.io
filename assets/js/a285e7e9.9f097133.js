"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[918],{28403:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(87462),r=a(67294),l=a(86010),i=a(72389),o=a(67392),p=a(7094),s=a(12466);const u="tabList__CuJ",d="tabItem_LNqP";function m(e){var t,a;const{lazy:i,block:m,defaultValue:c,values:k,groupId:h,className:g}=e,N=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=k?k:N.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),b=(0,o.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error('Docusaurus error: Duplicate values "'+b.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const v=null===c?c:null!=(t=null!=c?c:null==(a=N.find((e=>e.props.default)))?void 0:a.props.value)?t:N[0].props.value;if(null!==v&&!f.some((e=>e.value===v)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+f.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:y,setTabGroupChoices:x}=(0,p.U)(),[I,w]=(0,r.useState)(v),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,s.o5)();if(null!=h){const e=y[h];null!=e&&e!==I&&f.some((t=>t.value===e))&&w(e)}const E=e=>{const t=e.currentTarget,a=C.indexOf(t),n=f[a].value;n!==I&&(T(t),w(n),null!=h&&x(h,String(n)))},P=e=>{var t;let a=null;switch(e.key){case"ArrowRight":{var n;const t=C.indexOf(e.currentTarget)+1;a=null!=(n=C[t])?n:C[0];break}case"ArrowLeft":{var r;const t=C.indexOf(e.currentTarget)-1;a=null!=(r=C[t])?r:C[C.length-1];break}}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",u)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":m},g)},f.map((e=>{let{value:t,label:a,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:I===t?0:-1,"aria-selected":I===t,key:t,ref:e=>C.push(e),onKeyDown:P,onFocus:E,onClick:E},i,{className:(0,l.Z)("tabs__item",d,null==i?void 0:i.className,{"tabs__item--active":I===t})}),null!=a?a:t)}))),i?(0,r.cloneElement)(N.filter((e=>e.props.value===I))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},N.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==I})))))}function c(e){const t=(0,i.Z)();return r.createElement(m,(0,n.Z)({key:String(t)},e))}},90872:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(28403),l=a(72905),i=a(55483);const o=e=>{let{verb:t,payload:a,url:o,title:p,endpointType:s="Unleash server API"}=e;const u=(null==t?void 0:t.toUpperCase())||"",d=JSON.stringify(a,null,2),[m,c]="Unleash server API"===s?["unleash-url","API-token"]:["proxy-url","proxy-client-key"],k=(a?"\n"+u+" <"+m+">/"+o+"\nAuthorization: <"+c+">\ncontent-type: application/json\n\n"+d:"\n"+u+" <"+m+">/"+o+"\nAuthorization: <"+c+">\ncontent-type: application/json").trim(),h=(a?'\ncurl -H "Content-Type: application/json" \\\n     -H "Authorization: <'+c+'>" \\\n     -X '+u+" \\\n     -d '"+d+"' \\\n     <"+m+">/"+o:'\ncurl -H "Content-Type: application/json" \\\n     -H "Authorization: <'+c+'>" \\\n     -X '+u+" \\\n     <"+m+">/"+o).trim(),g=(a?"echo '"+d+"' \\\n| http "+u+" \\\n  <"+m+">/"+o+" \\\n  Authorization:<"+c+">":("\nhttp "+u+" \\\n  <"+m+">/"+o+" \\\n  Authorization:<"+c+"> \\\n  "+("POST"!==u||d?"":"--json")).trim()).trim();return n.createElement(r.Z,{groupId:"api-request"},n.createElement(l.Z,{value:"http",label:"HTTP"},n.createElement(i.Z,{language:"http",title:p},k)),n.createElement(l.Z,{value:"curl",label:"cURL"},n.createElement(i.Z,{language:"bash",title:p},h)),n.createElement(l.Z,{value:"httpie",label:"HTTPie"},n.createElement(i.Z,{language:"bash",title:p},g)))}},57621:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>u});var n=a(87462),r=(a(67294),a(3905)),l=a(90872);const i={id:"import_export",title:"Import & Export"},o=void 0,p={unversionedId:"deploy/import_export",id:"deploy/import_export",title:"Import & Export",description:"The import and export API first appeared in Unleash 3.3.0.",source:"@site/docs/deploy/import-export.md",sourceDirName:"deploy",slug:"/deploy/import_export",permalink:"/deploy/import_export",draft:!1,editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/deploy/import-export.md",tags:[],version:"current",frontMatter:{id:"import_export",title:"Import & Export"},sidebar:"documentation",previous:{title:"Google Auth Hook",permalink:"/deploy/google_auth"},next:{title:"Migration Guide",permalink:"/deploy/migration_guide"}},s={},u=[{value:"Runtime import &amp; export",id:"runtime-import--export",level:2},{value:"State Service",id:"state-service",level:3},{value:"API Export",id:"api-export",level:3},{value:"API Import",id:"api-import",level:3},{value:"Startup import",id:"startup-import",level:2},{value:"Importing files",id:"importing-files",level:3},{value:"Drop before import",id:"drop-before-import",level:3}],d={toc:u};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"Availability",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The import and export API first appeared in Unleash 3.3.0.")),(0,r.kt)("p",null,"Unleash supports import and export of feature toggles and strategies at startup and during runtime. The import mechanism guarantees that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"all imported features will be non-archived"),(0,r.kt)("li",{parentName:"ul"},"existing updates to strategies and features are included in the event history")),(0,r.kt)("p",null,"All import mechanisms support a ",(0,r.kt)("inlineCode",{parentName:"p"},"drop")," parameter which will clean the database before import (all strategies and features will be removed)."),(0,r.kt)("admonition",{title:"Dropping in production",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Be careful when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"drop")," parameter in production environments: cleaning the database could lead to unintended loss of data.")),(0,r.kt)("h2",{id:"runtime-import--export"},"Runtime import & export"),(0,r.kt)("h3",{id:"state-service"},"State Service"),(0,r.kt)("p",null,"Unleash returns a StateService when started, you can use this to import and export data at any time."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const unleash = require('unleash-server');\n\nconst { services } = await unleash.start({...});\nconst { stateService } = services;\n\nconst exportedData = await stateService.export({includeStrategies: false, includeFeatureToggles: true, includeTags: true, includeProjects: true});\n\nawait stateService.import({data: exportedData, userName: 'import', dropBeforeImport: false});\n\nawait stateService.importFile({file: 'exported-data.yml', userName: 'import', dropBeforeImport: true})\n")),(0,r.kt)("p",null,"If you want the database to be cleaned before import (all strategies and features will be removed), set the ",(0,r.kt)("inlineCode",{parentName:"p"},"dropBeforeImport")," parameter."),(0,r.kt)("p",null,"It is also possible to not override existing feature toggles (and strategies) by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"keepExisting")," parameter."),(0,r.kt)("h3",{id:"api-export"},"API Export"),(0,r.kt)("p",null,"The api endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/admin/state/export")," will export feature-toggles and strategies as json by default.\nYou can customize the export with query parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"format"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"json")),(0,r.kt)("td",{parentName:"tr",align:null},"Export format, either ",(0,r.kt)("inlineCode",{parentName:"td"},"json")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"yaml"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"download"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false")),(0,r.kt)("td",{parentName:"tr",align:null},"If the exported data should be downloaded as a file")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"featureToggles"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"Include feature-toggles in the exported data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"strategies"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"Include strategies in the exported data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tags"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"Include tagtypes, tags and feature_tags in the exported data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"projects"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"Include projects in the exported data")))),(0,r.kt)("p",null,"For example if you want to download just feature-toggles as yaml:"),(0,r.kt)(l.Z,{verb:"get",url:"api/admin/state/export?format=yaml&featureToggles=1&strategies=0&tags=0&projects=0&download=1",title:"Export features (and nothing else) as YAML.",mdxType:"ApiRequest"}),(0,r.kt)("h3",{id:"api-import"},"API Import"),(0,r.kt)("p",null,"You can import feature-toggles and strategies by POSTing to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/admin/state/import")," endpoint (keep in mind this will require authentication).\\\nYou can either send the data as JSON in the POST-body or send a ",(0,r.kt)("inlineCode",{parentName:"p"},"file")," parameter with ",(0,r.kt)("inlineCode",{parentName:"p"},"multipart/form-data")," (YAML files are also accepted here)."),(0,r.kt)("p",null,"You can customize the import with query parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"drop"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false")),(0,r.kt)("td",{parentName:"tr",align:null},"If the database should be cleaned before import (see comment below)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keep"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true")),(0,r.kt)("td",{parentName:"tr",align:null},"If true, the existing feature toggles and strategies will not be override")))),(0,r.kt)("p",null,"If you want the database to be cleaned before import (",(0,r.kt)("strong",{parentName:"p"},"all strategies and features will be removed"),"), specify a ",(0,r.kt)("inlineCode",{parentName:"p"},"drop")," query parameter."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You should never use this in production environments.")),(0,r.kt)("p",null,"Example usage:"),(0,r.kt)(l.Z,{verb:"post",url:"api/admin/state/import",payload:{version:3,features:[{name:"a-feature-toggle",enabled:!0,description:"#1 feature-toggle"}]},title:"Import data into Unleash.",mdxType:"ApiRequest"}),(0,r.kt)("h2",{id:"startup-import"},"Startup import"),(0,r.kt)("p",null,"You can import toggles and strategies on startup by using an import file in JSON or YAML format. As with other forms of imports, you can also choose to remove the current toggle and strategy configuration in the database before importing."),(0,r.kt)("p",null,"Unleash lets you do this both via configuration parameters and environment variables. The relevant parameters/variables are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"config parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"environment variable"),(0,r.kt)("th",{parentName:"tr",align:null},"default"),(0,r.kt)("th",{parentName:"tr",align:null},"value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"importFile")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"IMPORT_FILE")),(0,r.kt)("td",{parentName:"tr",align:null},"none"),(0,r.kt)("td",{parentName:"tr",align:null},"path to the configuration file")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"dropBeforeImport")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"IMPORT_DROP_BEFORE_IMPORT")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false")),(0,r.kt)("td",{parentName:"tr",align:null},"whether to clean the database before importing the file")))),(0,r.kt)("h3",{id:"importing-files"},"Importing files"),(0,r.kt)("p",null,"To import strategies and toggles from a file (called ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration.yml")," in the examples below), either"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"use the ",(0,r.kt)("inlineCode",{parentName:"p"},"importFile")," parameter to point to the file (you can also passed this into the ",(0,r.kt)("inlineCode",{parentName:"p"},"unleash.start()")," entry point)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"unleash-server --databaseUrl [...] \\\n           --importFile configuration.yml\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"set the ",(0,r.kt)("inlineCode",{parentName:"p"},"IMPORT_FILE")," environment variable to the path of the file before starting Unleash"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"IMPORT_FILE=configuration.yml\n")))),(0,r.kt)("h3",{id:"drop-before-import"},"Drop before import"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"You should never use this in production environments.")),(0,r.kt)("p",null,"To remove pre-existing feature toggles and strategies in the database before importing the new ones, either:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"add the ",(0,r.kt)("inlineCode",{parentName:"p"},"dropBeforeImport")," flag to the ",(0,r.kt)("inlineCode",{parentName:"p"},"unleash-server")," command (or to ",(0,r.kt)("inlineCode",{parentName:"p"},"unleash.start()"),")"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"unleash-server --databaseUrl [...] \\\n           --importFile configuration.yml \\\n           --dropBeforeImport\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"set the ",(0,r.kt)("inlineCode",{parentName:"p"},"IMPORT_DROP_BEFORE_IMPORT")," environment variable (note the leading ",(0,r.kt)("inlineCode",{parentName:"p"},"IMPORT_"),") to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"t"),", or ",(0,r.kt)("inlineCode",{parentName:"p"},"1"),". The variable is case-sensitive."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"IMPORT_DROP_BEFORE_IMPORT=true\n")))))}m.isMDXComponent=!0}}]);