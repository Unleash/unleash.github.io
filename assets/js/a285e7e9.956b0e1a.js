"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[918],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),m=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=m(e.components);return n.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=m(a),c=r,k=u["".concat(p,".").concat(c)]||u[c]||s[c]||i;return a?n.createElement(k,l(l({ref:t},d),{},{components:a})):n.createElement(k,l({ref:t},d))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var m=2;m<i;m++)l[m]=a[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},7621:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return m},toc:function(){return d},default:function(){return u}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),l=["components"],o={id:"import_export",title:"Import & Export"},p=void 0,m={unversionedId:"deploy/import_export",id:"deploy/import_export",title:"Import & Export",description:"since v3.3.0",source:"@site/docs/deploy/import-export.md",sourceDirName:"deploy",slug:"/deploy/import_export",permalink:"/deploy/import_export",editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/deploy/import-export.md",tags:[],version:"current",frontMatter:{id:"import_export",title:"Import & Export"},sidebar:"documentation",previous:{title:"Google Auth Hook",permalink:"/deploy/google_auth"},next:{title:"Migration Guide",permalink:"/deploy/migration_guide"}},d=[{value:"Runtime import &amp; export",id:"runtime-import--export",children:[{value:"State Service",id:"state-service",children:[],level:3},{value:"API Export",id:"api-export",children:[],level:3},{value:"API Import",id:"api-import",children:[],level:3}],level:2},{value:"Startup import",id:"startup-import",children:[{value:"Importing files",id:"importing-files",children:[],level:3},{value:"Drop before import",id:"drop-before-import",children:[],level:3}],level:2}],s={toc:d};function u(e){var t=e.components,a=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"since v3.3.0")),(0,i.kt)("p",null,"Unleash supports import and export of feature toggles and strategies at startup and during runtime. The import mechanism guarantees that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"all imported features will be non-archived"),(0,i.kt)("li",{parentName:"ul"},"existing updates to strategies and features are included in the event history")),(0,i.kt)("p",null,"All import mechanisms support a ",(0,i.kt)("inlineCode",{parentName:"p"},"drop")," parameter which will clean the database before import (all strategies and features will be removed)."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Dropping in production")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Be careful when using the ",(0,i.kt)("inlineCode",{parentName:"p"},"drop")," parameter in production environments: cleaning the database could lead to unintended loss of data."))),(0,i.kt)("h2",{id:"runtime-import--export"},"Runtime import & export"),(0,i.kt)("h3",{id:"state-service"},"State Service"),(0,i.kt)("p",null,"Unleash returns a StateService when started, you can use this to import and export data at any time."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const unleash = require('unleash-server');\n\nconst { services } = await unleash.start({...});\nconst { stateService } = services;\n\nconst exportedData = await stateService.export({includeStrategies: false, includeFeatureToggles: true, includeTags: true, includeProjects: true});\n\nawait stateService.import({data: exportedData, userName: 'import', dropBeforeImport: false});\n\nawait stateService.importFile({file: 'exported-data.yml', userName: 'import', dropBeforeImport: true})\n")),(0,i.kt)("p",null,"If you want the database to be cleaned before import (all strategies and features will be removed), set the ",(0,i.kt)("inlineCode",{parentName:"p"},"dropBeforeImport")," parameter."),(0,i.kt)("p",null,"It is also possible to not override existing feature toggles (and strategies) by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"keepExisting")," parameter."),(0,i.kt)("h3",{id:"api-export"},"API Export"),(0,i.kt)("p",null,"The api endpoint ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/admin/state/export")," will export feature-toggles and strategies as json by default.\nYou can customize the export with query parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"format"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"json")),(0,i.kt)("td",{parentName:"tr",align:null},"Export format, either ",(0,i.kt)("inlineCode",{parentName:"td"},"json")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"yaml"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"download"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"If the exported data should be downloaded as a file")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"featureToggles"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"Include feature-toggles in the exported data")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"strategies"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"Include strategies in the exported data")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"tags"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"Include tagtypes, tags and feature_tags in the exported data")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"projects"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"Include projects in the exported data")))),(0,i.kt)("p",null,"For example if you want to download just feature-toggles as yaml:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/admin/state/export?format=yaml&featureToggles=1&strategies=0&tags=0&projects=0&download=1\n")),(0,i.kt)("p",null,"Example with curl:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl -X GET -H "Content-Type: application/json" \\\n  -H "Authorization: Basic YWRtaW46" \\\n  http://unleash.herokuapp.com/api/admin/state/export?&featureToggles=1&strategies=0 > export.json\n')),(0,i.kt)("h3",{id:"api-import"},"API Import"),(0,i.kt)("p",null,"You can import feature-toggles and strategies by POSTing to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/admin/state/import")," endpoint (keep in mind this will require authentication).\\\nYou can either send the data as JSON in the POST-body or send a ",(0,i.kt)("inlineCode",{parentName:"p"},"file")," parameter with ",(0,i.kt)("inlineCode",{parentName:"p"},"multipart/form-data")," (YAML files are also accepted here)."),(0,i.kt)("p",null,"You can customize the import with query parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"drop"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"If the database should be cleaned before import (see comment below)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"keep"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")),(0,i.kt)("td",{parentName:"tr",align:null},"If true, the existing feature toggles and strategies will not be override")))),(0,i.kt)("p",null,"If you want the database to be cleaned before import (",(0,i.kt)("strong",{parentName:"p"},"all strategies and features will be removed"),"), specify a ",(0,i.kt)("inlineCode",{parentName:"p"},"drop")," query parameter."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"You should never use this in production environments.")),(0,i.kt)("p",null,"Example usage:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /api/admin/state/import\n{\n    "features": [\n        {\n            "name": "a-feature-toggle",\n            "enabled": true,\n            "description": "#1 feature-toggle"\n        }\n    ]\n}\n')),(0,i.kt)("p",null,"Example with curl:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl -X POST -H "Content-Type: application/json" \\\n  -H "Authorization: Basic YWRtaW46" -d @export.json \\\n  http://localhost:4242/api/admin/state/import\n')),(0,i.kt)("p",null,"*",") Remember to set correct token for Authorization."),(0,i.kt)("h2",{id:"startup-import"},"Startup import"),(0,i.kt)("p",null,"You can import toggles and strategies on startup by using an import file in JSON or YAML format. As with other forms of imports, you can also choose to remove the current toggle and strategy configuration in the database before importing."),(0,i.kt)("p",null,"Unleash lets you do this both via configuration parameters and environment variables. The relevant parameters/variables are:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"config parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"environment variable"),(0,i.kt)("th",{parentName:"tr",align:null},"default"),(0,i.kt)("th",{parentName:"tr",align:null},"value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"importFile")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"IMPORT_FILE")),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"path to the configuration file")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"dropBeforeImport")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"IMPORT_DROP_BEFORE_IMPORT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"whether to clean the database before importing the file")))),(0,i.kt)("h3",{id:"importing-files"},"Importing files"),(0,i.kt)("p",null,"To import strategies and toggles from a file (called ",(0,i.kt)("inlineCode",{parentName:"p"},"configuration.yml")," in the examples below), either"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"use the ",(0,i.kt)("inlineCode",{parentName:"p"},"importFile")," parameter to point to the file (you can also passed this into the ",(0,i.kt)("inlineCode",{parentName:"p"},"unleash.start()")," entry point)"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"unleash-server --databaseUrl [...] \\\n           --importFile configuration.yml\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"set the ",(0,i.kt)("inlineCode",{parentName:"p"},"IMPORT_FILE")," environment variable to the path of the file before starting Unleash"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"IMPORT_FILE=configuration.yml\n")))),(0,i.kt)("h3",{id:"drop-before-import"},"Drop before import"),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You should never use this in production environments."))),(0,i.kt)("p",null,"To remove pre-existing feature toggles and strategies in the database before importing the new ones, either:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"add the ",(0,i.kt)("inlineCode",{parentName:"p"},"dropBeforeImport")," flag to the ",(0,i.kt)("inlineCode",{parentName:"p"},"unleash-server")," command (or to ",(0,i.kt)("inlineCode",{parentName:"p"},"unleash.start()"),")"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"unleash-server --databaseUrl [...] \\\n           --importFile configuration.yml \\\n           --dropBeforeImport\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"set the ",(0,i.kt)("inlineCode",{parentName:"p"},"IMPORT_DROP_BEFORE_IMPORT")," environment variable (note the leading ",(0,i.kt)("inlineCode",{parentName:"p"},"IMPORT_"),") to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"t"),", or ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),". The variable is case-sensitive."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"IMPORT_DROP_BEFORE_IMPORT=true\n")))))}u.isMDXComponent=!0}}]);