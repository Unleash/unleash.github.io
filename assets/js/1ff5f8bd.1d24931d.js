"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[8726],{84970:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var o=t(87462),a=(t(67294),t(3905));const l={title:"Android",slug:"/reference/sdks/android-proxy"},i=void 0,s={unversionedId:"generated/sdks/client-side/android-proxy",id:"generated/sdks/client-side/android-proxy",title:"Android",description:"This document was generated from the README in the Android GitHub repository.",source:"@site/docs/generated/sdks/client-side/android-proxy.md",sourceDirName:"generated/sdks/client-side",slug:"/reference/sdks/android-proxy",permalink:"/reference/sdks/android-proxy",draft:!1,editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/generated/sdks/client-side/android-proxy.md",tags:[],version:"current",frontMatter:{title:"Android",slug:"/reference/sdks/android-proxy"},sidebar:"documentation",previous:{title:"Rust",permalink:"/reference/sdks/rust"},next:{title:"Flutter",permalink:"/reference/sdks/flutter"}},r={},d=[{value:"Getting started",id:"getting-started",level:2},{value:"Step 1",id:"step-1",level:3},{value:"Gradle",id:"gradle",level:4},{value:"Maven",id:"maven",level:4},{value:"Minimum Android SDK",id:"minimum-android-sdk",level:4},{value:"Proguard",id:"proguard",level:4},{value:"Step 2: Enable internet",id:"step-2-enable-internet",level:3},{value:"Step 3: Configure your client instance",id:"step-3-configure-your-client-instance",level:3},{value:"Step 3a: Unleash Context",id:"step-3a-unleash-context",level:4},{value:"Step 3b: Unleash Config",id:"step-3b-unleash-config",level:4},{value:"Connection options",id:"connection-options",level:5},{value:"Step 3b: Configure client polling proxy",id:"step-3b-configure-client-polling-proxy",level:5},{value:"Step 3b: Configure client loading toggles from a file",id:"step-3b-configure-client-loading-toggles-from-a-file",level:5},{value:"Step 4: Instantiate the client",id:"step-4-instantiate-the-client",level:3},{value:"Details",id:"details",level:3},{value:"PollingModes",id:"pollingmodes",level:4},{value:"Autopolling",id:"autopolling",level:5},{value:"FilePolling (since v0.2)",id:"filepolling-since-v02",level:5},{value:"Metrics (since v0.2)",id:"metrics-since-v02",level:3},{value:"NB Only supported by SDK version &gt;=26",id:"nb-only-supported-by-sdk-version-26",level:4},{value:"Example main activity",id:"example-main-activity",level:4}],p={toc:d};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{title:"Generated content",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This document was generated from the README in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Unleash/unleash-android-proxy-sdk"},"Android GitHub repository"),".")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"To connect to Unleash from a client-side context, you'll need to use the ",(0,a.kt)("a",{parentName:"p",href:"/reference/front-end-api"},"Unleash front-end API")," (",(0,a.kt)("a",{parentName:"p",href:"/how-to/how-to-create-api-tokens"},"how do I create an API token?"),") or the ",(0,a.kt)("a",{parentName:"p",href:"/reference/unleash-proxy"},"Unleash proxy")," (",(0,a.kt)("a",{parentName:"p",href:"/reference/api-tokens-and-client-keys#proxy-client-keys"},"how do I create client keys?"),").")),(0,a.kt)("h1",{id:"unleash-android-sdk"},"Unleash Android SDK"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://coveralls.io/github/Unleash/unleash-android-proxy-sdk?branch=main"},(0,a.kt)("img",{parentName:"a",src:"https://coveralls.io/repos/github/Unleash/unleash-android-proxy-sdk/badge.svg?branch=main",alt:"Coverage Status"})),"\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Unleash/unleash-android-proxy-sdk/actions/workflows/test.yml"},(0,a.kt)("img",{parentName:"a",src:"https://github.com/Unleash/unleash-android-proxy-sdk/actions/workflows/test.yml/badge.svg",alt:"main"})),"\n",(0,a.kt)("a",{parentName:"p",href:"https://search.maven.org/search?q=g:io.getunleash%20AND%20a:unleash-android-proxy-sdk"},(0,a.kt)("img",{parentName:"a",src:"https://badgen.net/maven/v/maven-central/io.getunleash/unleash-android-proxy-sdk",alt:"latest"})),"\n",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/unleash-android-proxy-sdk"},"KDoc")),(0,a.kt)("h2",{id:"getting-started"},"Getting started"),(0,a.kt)("h3",{id:"step-1"},"Step 1"),(0,a.kt)("p",null,"You will require the SDK on your classpath, so go ahead and add it to your dependency management file"),(0,a.kt)("h4",{id:"gradle"},"Gradle"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'implementation("io.getunleash:unleash-android-proxy-sdk:${unleash.sdk.version}")\n')),(0,a.kt)("h4",{id:"maven"},"Maven"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>io.getunleash</groupId>\n    <artifactId>unleash-android-proxy-sdk</artifactId>\n    <version>Latest version here</version>\n</dependency>\n")),(0,a.kt)("h4",{id:"minimum-android-sdk"},"Minimum Android SDK"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"We are currently aiming for a minimum SDK level of 21. Keeping in tune with OkHttp's requirement.")),(0,a.kt)("h4",{id:"proguard"},"Proguard"),(0,a.kt)("p",null,"For now, you'll need to have Proguard ignore our classes as well as fasterxml (Jackson)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"-keep public class io.getunleash.** {*;}\n-keep class com.fasterxml.** { *; }\n")),(0,a.kt)("h3",{id:"step-2-enable-internet"},"Step 2: Enable internet"),(0,a.kt)("p",null,"Your app will need internet permission in order to reach the proxy. So in your manifest file add"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<uses-permission android:name="android.permission.INTERNET" />\n')),(0,a.kt)("h3",{id:"step-3-configure-your-client-instance"},"Step 3: Configure your client instance"),(0,a.kt)("p",null,"Now configure your client instance"),(0,a.kt)("p",null,"You should use a singleton pattern to avoid file contention on cache directory."),(0,a.kt)("h4",{id:"step-3a-unleash-context"},"Step 3a: Unleash Context"),(0,a.kt)("p",null,"The important properties to configure on the context are"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Appname - In case you use strategies that depend on which app"),(0,a.kt)("li",{parentName:"ul"},"UserId - GradualRolloutStrategies often use this to decide stickiness when assigning which group of users the user end up in"),(0,a.kt)("li",{parentName:"ul"},"SessionId - GradualRolloutStrategies often use this to decide stickiness")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'import io.getunleash.UnleashContext\n\nval context = UnleashContext.newBuilder()\n    .appName("Your AppName")\n    .userId("However you resolve your userid")\n    .sessionId("However you resolve your session id") \n    .build()\n')),(0,a.kt)("h4",{id:"step-3b-unleash-config"},"Step 3b: Unleash Config"),(0,a.kt)("p",null,"To create a client, use the UnleashConfig.newBuilder method. When building a configuration, you'll need to provide it with:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"proxyUrl"),": the URL the Unleash front-end API is available at ",(0,a.kt)("strong",{parentName:"li"},"OR")," the URL your proxy is available at"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"clientKey"),": the API token or proxy client key you wish to use (this method was known as clientSecret prior to version 0.4.0)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pollMode"),": how you want to load the toggle status")),(0,a.kt)("p",null,"As of v0.1 the SDK supports an automatic polling with an adjustable poll period or loading the state from disk. Most users will probably want to use the polling client, but it's nice to know that you can instantiate your client without actually needing Internet if you choose loading from File"),(0,a.kt)("h5",{id:"connection-options"},"Connection options"),(0,a.kt)("p",null,"To connect this SDK to your Unleash instance's ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/front-end-api"},"front-end API"),", use the URL to your Unleash instance's front-end API (",(0,a.kt)("inlineCode",{parentName:"p"},"<unleash-url>/api/frontend"),") as the ",(0,a.kt)("inlineCode",{parentName:"p"},"proxyUrl")," argument. For the ",(0,a.kt)("inlineCode",{parentName:"p"},"clientKey")," parameter, use a ",(0,a.kt)("inlineCode",{parentName:"p"},"FRONTEND")," token generated from your Unleash instance. Refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/how-to/how-to-create-api-tokens"},(0,a.kt)("em",{parentName:"a"},"how to create API tokens"))," guide for the necessary steps."),(0,a.kt)("p",null,"To connect this SDK to the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-proxy"},"Unleash proxy"),", use the proxy's URL and a ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/api-tokens-and-client-keys#proxy-client-keys"},"proxy client key"),". The ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-proxy#configuration"},(0,a.kt)("em",{parentName:"a"},"configuration")," section of the Unleash proxy docs")," contains more info on how to configure client keys for your proxy."),(0,a.kt)("h5",{id:"step-3b-configure-client-polling-proxy"},"Step 3b: Configure client polling proxy"),(0,a.kt)("p",null,"Configuring a client with a 60 seconds poll interval:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'val config = UnleashConfig.newBuilder()\n    .proxyUrl("URL to your front-end API or proxy")\n    .clientKey("your front-end API token or proxy client key")\n    .pollingMode(PollingModes.autoPoll(60) { // poll interval in seconds\n        featuresUpdated()\n    })\n    .build()\n')),(0,a.kt)("h5",{id:"step-3b-configure-client-loading-toggles-from-a-file"},"Step 3b: Configure client loading toggles from a file"),(0,a.kt)("p",null,"If you need to have a known state for your UnleashClient, you can perform a query against the proxy using your HTTP client of choice and save the output as a json file. Then you can tell Unleash to use this file to setup toggle states."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'import io.getunleash.UnleashConfig\nimport io.getunleash.polling.PollingModes\n\nval toggles = File("/tmp/proxyresponse.json")\nval pollingMode = PollingModes.fileMode(toggles)\n\nval config = UnleashConfig.newBuilder()\n    .proxyUrl("Doesn\'t matter since we don\'t use it when sent a file")\n    .clientKey("Doesn\'t matter since we don\'t use it when sent a file")\n    .pollMode(pollingMode)\n    .build()\n')),(0,a.kt)("h3",{id:"step-4-instantiate-the-client"},"Step 4: Instantiate the client"),(0,a.kt)("p",null,"Having created your UnleashContext and your UnleashConfig you can now instantiate your client. Make sure you only do this once, and pass the instantiated client to classes/functions that need it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"import io.getunleash.UnleashClient\n\nval unleashClient = UnleashClient(unleashConfig = config, unleashContext = context)\n")),(0,a.kt)("h3",{id:"details"},"Details"),(0,a.kt)("h4",{id:"pollingmodes"},"PollingModes"),(0,a.kt)("h5",{id:"autopolling"},"Autopolling"),(0,a.kt)("p",null,"If you'd like for changes in toggles to take effect for you; use AutoPolling.\nYou can configure the pollInterval and a listener that gets notified when toggles are updated in the background thread.\nIf you set the poll interval to 0, the SDK will fetch once, but not set up polling."),(0,a.kt)("p",null,"The listener is a no-argument lambda that gets called by the RefreshPolicy for every poll that"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Does not return ",(0,a.kt)("inlineCode",{parentName:"li"},"304 - Not Modified")),(0,a.kt)("li",{parentName:"ol"},"Does not return a list of toggles that's exactly the same as the one we've already stored in local cache. Just in case the ETag/If-None-Match fails.")),(0,a.kt)("p",null,"Example usage is equal to the ",(0,a.kt)("inlineCode",{parentName:"p"},"Example setup")," above"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'val context = UnleashContext.newBuilder()\n    .appName("Your AppName")\n    .userId("However you resolve your userid")\n    .sessionId("However you resolve your session id")\n    .build()\nval config = UnleashConfig.newBuilder()\n    .proxyUrl("URL to your front-end API or proxy")\n    .clientKey("your front-end API token or proxy client key")\n    .pollingMode(PollingModes.autoPoll(60) { // poll interval in seconds\n        featuresUpdated()\n    })\n    .build()\nval client = UnleashClient(unleashConfig = config, unleashContext = context)\n')),(0,a.kt)("h5",{id:"filepolling-since-v02"},"FilePolling (since v0.2)"),(0,a.kt)("p",null,"The name ",(0,a.kt)("inlineCode",{parentName:"p"},"FilePolling")," can be a tad misleading, since this policy doesn't actually poll, it simply loads a file of toggles from disk on startup, and uses that to answer all client calls.\nUseful when your app might have limited internet connectivity, you'd like to run tests with a known toggle state or you simply do not want background activity."),(0,a.kt)("p",null,"The following example shows how to use it, provided the file to use is located at /tmp/proxyresponse.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'val toggles = File("/tmp/proxyresponse.json")\nval pollingMode = PollingModes.fileMode(toggles)\nval context = UnleashContext.newBuilder()\n    .appName("Your AppName")\n    .userId("However you resolve your userid")\n    .sessionId("However you resolve your session id")\n    .build()\nval config = UnleashConfig.newBuilder()\n    .proxyUrl("URL to your front-end API or proxy") // These two don\'t matter for FilePolling,\n    .clientKey("front-end API token / proxy client key") // since the client never speaks to the proxy\n    .pollingMode(pollingMode)\n    .build()\nval client = UnleashClient(unleashConfig = config, unleashContext = context)\n\n')),(0,a.kt)("h3",{id:"metrics-since-v02"},"Metrics (since v0.2)"),(0,a.kt)("p",null,"If you'd like the client to post metrics to the proxy so the admin interface can be updated, add a call to ",(0,a.kt)("inlineCode",{parentName:"p"},"enableMetrics()"),"."),(0,a.kt)("h4",{id:"nb-only-supported-by-sdk-version-26"},"NB Only supported by SDK version >=26"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"val config = UnleashConfig\n    .newBuilder()\n    .appName()\n    .userId()\n    .sessionId()\n    .enableMetrics()\n    .build()\n")),(0,a.kt)("p",null,"The default configuration configures a daemon to report metrics once every minute, this can be altered using the ",(0,a.kt)("inlineCode",{parentName:"p"},"metricsInterval(long milliseconds)")," method on the builder, so if you'd rather see us post in 5 minutes intervals you could do"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"UnleashConfig().newBuilder().metricsInterval(300000) // Every 5 minutes\n")),(0,a.kt)("h4",{id:"example-main-activity"},"Example main activity"),(0,a.kt)("p",null,"In ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Unleash/unleash-android-proxy-sdk/blob/main/./samples/android/app/src/main/java/com/example/unleash/MainActivity.kt"},"the sample app"),"\nwe use this to update the text on the first view"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},' this@MainActivity.runOnUiThread {\n    val firstFragmentText = findViewById<TextView>(R.id.textview_first)\n    firstFragmentText.text = "Variant ${unleashClient.getVariant("unleash_android_sdk_demo").name}"\n }\n')),(0,a.kt)("hr",null),(0,a.kt)("p",null,"This content was generated on ",(0,a.kt)("time",{dateTime:"2023-09-29T15:13:36.735Z"},"29 September 2023 at 15:13:36 Coordinated Universal Time")))}u.isMDXComponent=!0}}]);