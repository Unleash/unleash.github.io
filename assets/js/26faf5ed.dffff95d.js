"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[59347],{32620:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(87462),l=(n(67294),n(3905));const i={title:"iOS",slug:"/reference/sdks/ios-proxy",custom_edit_url:"https://github.com/Unleash/unleash-proxy-client-swift/edit/main/README.md"},r=void 0,o={unversionedId:"generated/sdks/client-side/ios-proxy",id:"generated/sdks/client-side/ios-proxy",title:"iOS",description:"This document was generated from the README in the iOS GitHub repository.",source:"@site/docs/generated/sdks/client-side/ios-proxy.md",sourceDirName:"generated/sdks/client-side",slug:"/reference/sdks/ios-proxy",permalink:"/reference/sdks/ios-proxy",draft:!1,editUrl:"https://github.com/Unleash/unleash-proxy-client-swift/edit/main/README.md",tags:[],version:"current",frontMatter:{title:"iOS",slug:"/reference/sdks/ios-proxy",custom_edit_url:"https://github.com/Unleash/unleash-proxy-client-swift/edit/main/README.md"},sidebar:"documentation",previous:{title:"Flutter",permalink:"/reference/sdks/flutter"},next:{title:"JavaScript browser",permalink:"/reference/sdks/javascript-browser"}},s={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"iOS &gt;= 13",id:"ios--13",level:3},{value:"iOS &gt;= 12",id:"ios--12",level:3},{value:"Available options",id:"available-options",level:3},{value:"Update context",id:"update-context",level:3},{value:"Events",id:"events",level:2},{value:"Releasing",id:"releasing",level:2},{value:"Testing",id:"testing",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("admonition",{title:"Generated content",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"This document was generated from the README in the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Unleash/unleash-proxy-client-swift"},"iOS GitHub repository"),".")),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"To connect to Unleash from a client-side context, you'll need to use the ",(0,l.kt)("a",{parentName:"p",href:"/reference/front-end-api"},"Unleash front-end API")," (",(0,l.kt)("a",{parentName:"p",href:"/how-to/how-to-create-api-tokens"},"how do I create an API token?"),") or the ",(0,l.kt)("a",{parentName:"p",href:"/reference/unleash-proxy"},"Unleash proxy")," (",(0,l.kt)("a",{parentName:"p",href:"/reference/api-tokens-and-client-keys#proxy-client-keys"},"how do I create client keys?"),").")),(0,l.kt)("h1",{id:"unleash-proxy-client-swift"},"unleash-proxy-client-swift"),(0,l.kt)("p",null,"The unleash-proxy-client-swift makes it easy for native applications and other swift platforms to connect to the unleash proxy. The proxy will evaluate a feature toggle for a given ",(0,l.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/docs/user_guide/unleash_context"},"context")," and return a list of feature flags relevant for the provided context."),(0,l.kt)("p",null,"The unleash-proxy-client-swift will then cache these toggles in a map in memory and refresh the configuration at a configurable interval, making queries against the toggle configuration extremely fast."),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"MacOS: 12.15"),(0,l.kt)("li",{parentName:"ul"},"iOS: 12")),(0,l.kt)("h2",{id:"installation"},"Installation"),(0,l.kt)("p",null,"Follow the following steps in order to install the unleash-proxy-client-swift:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"In your Xcode project go to File -> Swift Packages -> Add Package Dependency"),(0,l.kt)("li",{parentName:"ol"},"Supply the link to this repository"),(0,l.kt)("li",{parentName:"ol"},"Set the appropriate package constraints (typically up to next major version)"),(0,l.kt)("li",{parentName:"ol"},"Let Xcode find and install the necessary packages")),(0,l.kt)("p",null,"Once you're done, you should see SwiftEventBus and UnleashProxyClientSwift listed as dependencies in the file explorer of your project."),(0,l.kt)("h2",{id:"usage"},"Usage"),(0,l.kt)("p",null,"In order to get started you need to import and instantiate the unleash client:"),(0,l.kt)("h3",{id:"ios--13"},"iOS >= 13"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'import SwiftUI\nimport UnleashProxyClientSwift\n\n// Setup Unleash in the context where it makes most sense\n\nvar unleash = UnleashProxyClientSwift.UnleashClient(unleashUrl: "https://<unleash-instance>/api/frontend", clientKey: "<client-side-api-token>", refreshInterval: 15, appName: "test", context: ["userId": "c3b155b0-5ebe-4a20-8386-e0cab160051e"])\n\nunleash.start()\n')),(0,l.kt)("h3",{id:"ios--12"},"iOS >= 12"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'import SwiftUI\nimport UnleashProxyClientSwift\n\n// Setup Unleash in the context where it makes most sense\n\nvar unleash = UnleashProxyClientSwift.UnleashClientBase(unleashUrl: "https://<unleash-instance>/api/frontend", clientKey: "<client-side-api-token>", refreshInterval: 15, appName: "test", context: ["userId": "c3b155b0-5ebe-4a20-8386-e0cab160051e"])\n\nunleash.start()\n')),(0,l.kt)("p",null,"In the example above we import the UnleashProxyClientSwift and instantiate the client. You need to provide the following parameters:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"unleashUrl"),": the full url to either the ",(0,l.kt)("a",{parentName:"li",href:"https://docs.getunleash.io/reference/front-end-api"},"Unleash front-end API")," OR an ",(0,l.kt)("a",{parentName:"li",href:"https://docs.getunleash.io/reference/unleash-proxy"},"Unleash proxy")," ","[String]"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"clientKey"),": either an ",(0,l.kt)("a",{parentName:"li",href:"https://docs.getunleash.io/reference/api-tokens-and-client-keys#front-end-tokens"},"client-side API token")," if you use the front-end API (",(0,l.kt)("a",{parentName:"li",href:"https://docs.getunleash.io/how-to/how-to-create-api-tokens",title:"how do I create API tokens?"},"how"),") or a ",(0,l.kt)("a",{parentName:"li",href:"https://docs.getunleash.io/reference/api-tokens-and-client-keys#proxy-client-keys"},"proxy client key")," if you use the proxy ","[String]"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"refreshInterval"),": the polling interval in seconds ","[Int]",". Set to ",(0,l.kt)("inlineCode",{parentName:"li"},"0"),"to only poll once and disable a periodic polling"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"appName"),": the application name identifier ","[String]"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"context"),": the context parameters except from ",(0,l.kt)("inlineCode",{parentName:"li"},"appName")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"environment")," which should be specified explicitly in the init [","[String: String]","]")),(0,l.kt)("p",null,"Running ",(0,l.kt)("inlineCode",{parentName:"p"},"unleash.start()")," will make the first request against the proxy and retrieve the feature toggle configuration, and set up the polling interval in the background."),(0,l.kt)("p",null,"NOTE: While waiting to boot up the configuration may not be available, which means that asking for a feature toggle may result in a false if the configuration has not loaded. In the event that you need to be certain that the configuration is loaded we emit an event you can subscribe to, once the configuration is loaded. See more in the Events section."),(0,l.kt)("p",null,"Once the configuration is loaded you can ask against the cache for a given feature toggle:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'if unleash.isEnabled(name: "ios") {\n    // do something\n} else {\n   // do something else\n}\n')),(0,l.kt)("p",null,"You can also set up ",(0,l.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/docs/advanced/toggle_variants"},"variants")," and use them in a similar fashion:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'var variant = unleash.getVariant(name: "ios")\nif variant.enabled {\n    // do something\n} else {\n   // do something else\n}\n')),(0,l.kt)("h3",{id:"available-options"},"Available options"),(0,l.kt)("p",null,"The Unleash SDK takes the following options:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"option"),(0,l.kt)("th",{parentName:"tr",align:null},"required"),(0,l.kt)("th",{parentName:"tr",align:null},"default"),(0,l.kt)("th",{parentName:"tr",align:null},"description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"unleashUrl"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"n/a"),(0,l.kt)("td",{parentName:"tr",align:null},"The Unleash Proxy URL to connect to. E.g.: ",(0,l.kt)("inlineCode",{parentName:"td"},"https://examples.com/proxy"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"clientKey"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"n/a"),(0,l.kt)("td",{parentName:"tr",align:null},"The Unleash Proxy Secret to be used")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"appName"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"unleash-swift-client"),(0,l.kt)("td",{parentName:"tr",align:null},"The name of the application using this SDK. Will be used as part of the metrics sent to Unleash Proxy. Will also be part of the Unleash Context.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"environment"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"default"),(0,l.kt)("td",{parentName:"tr",align:null},"The name of the environment using this SDK. Will be used as part of the metrics sent to Unleash Proxy. Will also be part of the Unleash Context.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"refreshInterval"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"15"),(0,l.kt)("td",{parentName:"tr",align:null},"How often, in seconds, the SDK should check for updated toggle configuration. If set to 0 will disable checking for updates")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"metricsInterval"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"30"),(0,l.kt)("td",{parentName:"tr",align:null},"How often, in seconds, the SDK should send usage metrics back to Unleash Proxy")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"disableMetrics"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"false"),(0,l.kt)("td",{parentName:"tr",align:null},"Set this option to ",(0,l.kt)("inlineCode",{parentName:"td"},"true")," if you want to disable usage metrics")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"context"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"[:]"),(0,l.kt)("td",{parentName:"tr",align:null},"The initial context parameters except from ",(0,l.kt)("inlineCode",{parentName:"td"},"appName")," and `environment which are specified as top level fields")))),(0,l.kt)("h3",{id:"update-context"},"Update context"),(0,l.kt)("p",null,"In order to update the context you can use the following method:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'var context: [String: String] = [:]\ncontext["userId"] = "c3b155b0-5ebe-4a20-8386-e0cab160051e"\nunleash.updateContext(context: context)\n')),(0,l.kt)("p",null,"This will stop and start the polling interval in order to renew polling with new context values."),(0,l.kt)("p",null,"You can use any of the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-context#structure"},"predefined fields"),". If you need to support\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.getunleash.io/reference/unleash-context#the-properties-field"},"custom properties")," pass them as the second argument:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'var context: [String: String] = [:]\ncontext["userId"] = "c3b155b0-5ebe-4a20-8386-e0cab160051e"\nvar properties: [String: String] = [:]\nproperties["customKey"] = "customValue";\nunleash.updateContext(context: context, properties: properties)\n')),(0,l.kt)("h2",{id:"events"},"Events"),(0,l.kt)("p",null,"The proxy client emits events that you can subscribe to. The following events are available:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},'"ready"'),(0,l.kt)("li",{parentName:"ul"},'"update"'),(0,l.kt)("li",{parentName:"ul"},'"sent" (metrics sent)'),(0,l.kt)("li",{parentName:"ul"},'"error" (metrics sending error)')),(0,l.kt)("p",null,"Usage them in the following manner:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'func handleReady() {\n    // do this when unleash is ready\n}\n\nunleash.subscribe(name: "ready", callback: handleReady)\n\nfunc handleUpdate() {\n    // do this when unleash is updated\n}\n\nunleash.subscribe(name: "update", callback: handleUpdate)\n')),(0,l.kt)("p",null,"The ready event is fired once the client has received it's first set of feature toggles and cached it in memory. Every subsequent event will be an update event that is triggered if there is a change in the feature toggle configuration."),(0,l.kt)("h2",{id:"releasing"},"Releasing"),(0,l.kt)("p",null,"Note: To release the package you'll need to have ",(0,l.kt)("a",{parentName:"p",href:"https://cocoapods.org/"},"CocoaPods")," installed."),(0,l.kt)("p",null,"First, you'll need to add a tag. Releasing the tag is enough for the Swift package manager, but it's polite to also ensure CocoaPods users can also consume the code."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'git tag -a 0.0.4 -m "v0.0.4"\n')),(0,l.kt)("p",null,"Please make sure that that tag is pushed to remote."),(0,l.kt)("p",null,"The next few commands assume that you have CocoaPods installed and available on your shell."),(0,l.kt)("p",null,"First, validate your session with cocoapods with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'pod trunk register <email> "Your name"\n')),(0,l.kt)("p",null,"The email that owns this package is the general unleash team email. Cocoapods will send a link to this email, click it to validate your shell session."),(0,l.kt)("p",null,"Bump the version number of the package, you can find this in ",(0,l.kt)("inlineCode",{parentName:"p"},"UnleashProxyClientSwift.podspec"),", we use SemVer for this project. Once that's committed and merged to main:"),(0,l.kt)("p",null,"Linting the podspec is always a good idea:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"pod spec lint UnleashProxyClientSwift.podspec\n")),(0,l.kt)("p",null,"Once that succeeds, you can do the actual release:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"pod trunk push UnleashProxyClientSwift.podspec --allow-warnings\n")),(0,l.kt)("h2",{id:"testing"},"Testing"),(0,l.kt)("p",null,"In order to test this package you can run the swift test command. To test thread safety, run swift test with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"swift test --sanitize=thread\n")),(0,l.kt)("p",null,"This will give you warnings in the console when you have any data races."),(0,l.kt)("hr",null),(0,l.kt)("p",null,"This content was generated on ",(0,l.kt)("time",{dateTime:"2024-01-30T00:13:44.516Z"},"30 January 2024 at 00:13:44 Coordinated Universal Time")))}d.isMDXComponent=!0}}]);