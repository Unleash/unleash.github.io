"use strict";(self.webpackChunkwebsitev_2=self.webpackChunkwebsitev_2||[]).push([[2937],{6889:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),i=a(51402);const o=e=>{let{img:t,alt:a,caption:o}=e;return n.createElement("figure",null,n.createElement("img",{alt:a,src:(0,i.Z)(t)}),n.createElement("figcaption",null,o))}},31183:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var n=a(87462),i=(a(67294),a(3905)),o=a(6889);const s={title:"How to add SSO with SAML 2.0 Azure"},l=void 0,r={unversionedId:"how-to/how-to-add-sso-azure-saml",id:"how-to/how-to-add-sso-azure-saml",title:"How to add SSO with SAML 2.0 Azure",description:"The Single-Sign-On capability is only available for customers on the Enterprise subscription. Check out the Unleash plans for details.",source:"@site/docs/how-to/how-to-add-sso-azure-saml.md",sourceDirName:"how-to",slug:"/how-to/how-to-add-sso-azure-saml",permalink:"/how-to/how-to-add-sso-azure-saml",draft:!1,editUrl:"https://github.com/Unleash/unleash/edit/main/website/docs/how-to/how-to-add-sso-azure-saml.md",tags:[],version:"current",frontMatter:{title:"How to add SSO with SAML 2.0 Azure"},sidebar:"documentation",previous:{title:"[Deprecated] How to add SSO with Google",permalink:"/how-to/how-to-add-sso-google"},next:{title:"How to set up Keycloak and Unleash to sync user groups",permalink:"/how-to/how-to-setup-sso-keycloak-group-sync"}},u={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Basic configuration",id:"basic-configuration",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Step 1: Create an Enterprise Application within Azure AD",id:"step-1",level:3},{value:"Step 2: Configure SSO via SAML in Azure AD",id:"step-2",level:3},{value:"Step 3: Configure SAML 2.0 provider in Unleash",id:"step-3",level:3},{value:"Validate",id:"validation",level:3},{value:"Group Syncing",id:"group-syncing",level:3}],h={toc:p};function d(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,n.Z)({},h,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"Availability",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("strong",{parentName:"p"},"Single-Sign-On capability")," is only available for customers on the Enterprise subscription. Check out the ",(0,i.kt)("a",{parentName:"p",href:"https://www.getunleash.io/plans"},"Unleash plans")," for details.")),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"This guides shows you how to use ",(0,i.kt)("a",{parentName:"p",href:"/reference/sso"},"Unleash's Single-Sign-On (SSO) integration")," with SAML 2.0 and how to connect it to Azure Active Directory as an ID provider (IdP)."),(0,i.kt)("h2",{id:"basic-configuration"},"Basic configuration"),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"This guide expects you to already have:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Administrator access to the Unleash instance you want to configure"),(0,i.kt)("li",{parentName:"ul"},"Azure AD access for your Azure instance")),(0,i.kt)("h3",{id:"step-1"},"Step 1: Create an Enterprise Application within Azure AD"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"a) Sign in to your Azure AD and create a new Enterprise Application"),"."),(0,i.kt)(o.Z,{caption:"In the Azure directory overview, use the add button and select the enterprise application option.",img:"/img/sso-azure-saml-add-enterprise-app.png",mdxType:"Figure"}),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"b) In the Azure AD gallery, select the option to create your own application.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"The Azure AD gallery. The &quot;create your own application&quot; button is highlighted.",src:a(65992).Z,width:"1336",height:"775"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"c) Next, provide the application with a name. When asked what you're looking to do with the application, select the \"Integrate any other application you don't find in the gallery (Non-gallery)\" option.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Azure application creation form. The name is set to &quot;UnleashSSO&quot; and the &quot;non-gallery&quot; option is selected.",src:a(80599).Z,width:"584",height:"380"})),(0,i.kt)("h3",{id:"step-2"},"Step 2: Configure SSO via SAML in Azure AD"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},'a) On the single sign-on page ("single sign-on" in the side bar), select the "SAML" option')),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Azure: SSO method selection page",src:a(35104).Z,width:"1416",height:"749"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"b) Section 1: Basic SAML Configuration {#basic-saml-configuration}")),(0,i.kt)("p",null,"When configuring SSO with SAML, you'll need to add an ",(0,i.kt)("strong",{parentName:"p"},"identifier")," and a ",(0,i.kt)("strong",{parentName:"p"},"reply URL"),".\nThe ",(0,i.kt)("strong",{parentName:"p"},"identifier")," is your Unleash URL. (For hosted instances, that's usually ",(0,i.kt)("inlineCode",{parentName:"p"},"https://<region>.app.unleash-hosted.com/<instanceName>"),")."),(0,i.kt)("p",null,"The ",(0,i.kt)("strong",{parentName:"p"},"reply URL")," is the Unleash callback URL. The Unleash callback URL is available on the Unleash SSO configuration page, and is typically your Unleash URL followed by ",(0,i.kt)("inlineCode",{parentName:"p"},"/auth/saml/callback"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Azure: The basic SAML configuration form with example values filled out for the required fields.",src:a(92535).Z,width:"772",height:"521"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"c) Section 2: Attributes & Claims {#attributes-and-claims}")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},'Set the "name identifier format" to "Email address".'),(0,i.kt)("li",{parentName:"ol"},'Select "attribute" as the source.'),(0,i.kt)("li",{parentName:"ol"},'Enter "user.mail" in the source attribute field.')),(0,i.kt)("p",null,"Optionally, you can also provide a first name and a last name. If provided, these will be used to enrich the data in Unleash."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Azure: The manage claim form with email configuration filled out",src:a(15788).Z,width:"756",height:"474"}),"\n",(0,i.kt)("img",{alt:"Azure: The list of claims used by the SAML setup, including the optional claims for given name and surname",src:a(58042).Z,width:"786",height:"352"})),(0,i.kt)("admonition",{title:"URLs and formats",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Make sure to replace URLs with the public URL for your Unleash instance. This will require correct region prefix and the instance name."),(0,i.kt)("p",{parentName:"admonition"},"The correct format is: https://",(0,i.kt)("strong",{parentName:"p"},"[region]"),".app.unleash-hosted.com/",(0,i.kt)("strong",{parentName:"p"},"[instanceName]"),"/auth/saml/callback")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"d) Sections 3 and 4: Azure AD setup details {#azure-details}")),(0,i.kt)("p",null,"You will need some details from section 3 and 4 of the SAML setup form to configure the integration within Unleash. These details are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Azure AD Identifier (from section 4)"),(0,i.kt)("li",{parentName:"ul"},"Login URL (from section 4)"),(0,i.kt)("li",{parentName:"ul"},"X.509 Certificate (in the Federation Metadata XML from section 3)")),(0,i.kt)(o.Z,{caption:"Section 3 contains a download link for the Federation Metadata XML file. Section 4 lists the Azure AD identifier and the login URL",img:"/img/sso-azure-saml-azure-details.png",mdxType:"Figure"}),(0,i.kt)(o.Z,{caption:"Within the Federation Metadata XML file, find the `X509Certificate` tag. You'll need the content within that tag.",img:"/img/sso-azure-saml-x509cert.png",mdxType:"Figure"}),(0,i.kt)("h3",{id:"step-3"},"Step 3: Configure SAML 2.0 provider in Unleash"),(0,i.kt)("p",null,'In order to configure SSO with SAML with your Unleash enterprise you should navigate to the Single-Sign-On configuration section and choose the "SAML 2.0" tab.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Unleash: sso-config screen",src:a(46515).Z,width:"1366",height:"785"})),(0,i.kt)("p",null,"Use the values from the ",(0,i.kt)("a",{parentName:"p",href:"#azure-details"},"previous section")," to fill out the form:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In the entity ID field, add the ",(0,i.kt)("strong",{parentName:"li"},"Azure AD identifier"),". It should look a little like this ",(0,i.kt)("inlineCode",{parentName:"li"},"https://sts.windows.net/**[identifier]**"),"."),(0,i.kt)("li",{parentName:"ol"},"In the single sign-on URL field, add the ",(0,i.kt)("strong",{parentName:"li"},"login URL"),". It should look something like ",(0,i.kt)("inlineCode",{parentName:"li"},"https://login.microsoftonline.com/**[identifier]**/saml2")),(0,i.kt)("li",{parentName:"ol"},"In the X.509 certificate field, add the content of the ",(0,i.kt)("inlineCode",{parentName:"li"},"X509Certificate")," tag from the ",(0,i.kt)("strong",{parentName:"li"},"federation metadata XML"),".")),(0,i.kt)("p",null,"Optionally, you may also choose to \u201cAuto-create users\u201d. This will make Unleash automatically create new users on the fly the first time they sign-in to Unleash with the given SSO provider (JIT). If you decide to automatically create users in Unleash you must also provide a list of valid email domains separated by commas. You must also decide which root Unleash role they will be assigned. Without this enabled you will need to manually add users to Unleash before SSO will work for their accounts and Unleash."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Unleash: SAML 2.0 filled out with entity ID, Single Sign-On URL, and X.509 certificate and auto-creating users for users with the &#39;@getunleash.ai&#39; and &#39;@getunleash.io&#39; emaiil domains.",src:a(12454).Z,width:"1103",height:"1300"})),(0,i.kt)("h3",{id:"validation"},"Validate"),(0,i.kt)("p",null,"If everything is set up correctly, you should now be able to sign in with the SAML 2.0 option. You can verify that this works by logging out of Unleash: the login screen should give you the option to sign in with SAML 2.0."),(0,i.kt)("p",null,'You can also test the integration in Azure by using the "test single sign on" step in the SAML setup wizard.'),(0,i.kt)(o.Z,{caption:"The SAML setup wizard contains a step that lets you test your SAML 2.0 integration. You can use this to verify that everything is configured correctly within Azure.",img:"/img/sso-azure-saml-test-user.png",mdxType:"Figure"}),(0,i.kt)("h3",{id:"group-syncing"},"Group Syncing"),(0,i.kt)("p",null,"Optionally, you can sync groups from Azure AD to Unleash to ",(0,i.kt)("a",{parentName:"p",href:"/how-to/how-to-set-up-group-sso-sync"},"map them to groups in Unleash"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"a) Add a group claim in Azure"),'\nIn section 2 (Attributes and claims) of the Azure SAML set-up, select the option to "Add a group claim".'),(0,i.kt)("p",null,'Check the box to "Customize the name of the group claim" and update the "Name" to something simple, such as "groups".'),(0,i.kt)("p",null,"Azure AD only supports sending a maximum of 150 groups in the SAML response. If you're using Azure AD and have users that are present in more than 150 groups, you'll need to add a filter in this section to the group claim to ensure that only the groups you want to sync are sent to Unleash."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Azure: section 2, attributes and claims, adding a group claim with the name &#39;group&#39;",src:a(38154).Z,width:"2024",height:"1173"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"b) Unleash SSO Setup"),'\nIn the Unleash Admin SSO section, enable the option to "Enable Group Syncing".'),(0,i.kt)("p",null,'Add the same "Name" you used from the previous section (eg. "groups") as the "Group Field JSON Path".'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Unleash: SAML 2.0 SSO setup, enabled group syncing with the Group Field JSON Path as &#39;groups&#39;",src:a(35354).Z,width:"839",height:"159"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note that Azure only supports sending up to 150 groups.")," If you have more groups than this, you can setup a filter in Azure to only send the relevant groups to Unleash."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Unleash: SAML 2.0 setup, filtering groups by name ",src:a(96858).Z,width:"1901",height:"854"})))}d.isMDXComponent=!0},58042:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-attributes-claim-be59386283d75ffae47d5b49914592b7.png"},65992:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-create-own-app-22c1a888e615292fb9a830776bb503dc.png"},96858:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-group-filtering-2d32960b3b1ac93ff8df467e718139f1.png"},38154:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-group-setup-83fa503de2c47fd89a5efa275769b919.png"},80599:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-name-app-8485a7def4bd07b13b03517eb0c9a983.png"},35104:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-saml-choice-5b04580b908e5a50977375e1bb52b26c.png"},92535:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-section-one-aca810f8477e936eb28eeae6a333168e.png"},15788:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-unique-id-email-id-c5218f891b40d684a7300d962c7906d9.png"},12454:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-unleash-config-4984a70c9d23dd9d171c859a82db90fc.png"},35354:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-azure-saml-unleash-group-settings-db8a4dd0b418fdfa0a873c39eca7249f.png"},46515:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sso-configure-saml-5b4bc8f7d79873fced0c335184e8cb49.png"}}]);